---
title: Results
output:
  bookdown::html_document2: default
  bookdown::pdf_document2:
    keep_tex: yes
  bookdown::word_document2:
    toc: yes
  html_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
    df_print: paged
bibliography: library.bib
---

# Results

## Data completeness

### Missing amounts

There were five recipes, all from Norway, that included ingredients where the amount in kilos could not be found. These ingredients were herbs (1), spices (1), wasabi (2) and duck fat used for confit (1).

### Missing nutrition information and sustainability indicators

For all three countries, the median percentage of the weight of the recipe that was mapped to a nutrient database or the SHARP Indicators database was 0, and the interquartile range was 100, 100. See **Figure** \@ref(fig:data-completeness)A and B.

```{r data-completeness, fig.cap = "Percentage of the recipe in weight not mapped to a nutrient database (A) and SHARP Indicators database (B).", fig.width=10, fig.asp=0.45}
#Nutrient plot
nutrients_completeness <- plotViolinBox(data_completeness$no_nutrient_info) +
    scale_color_manual(values = group_colors) +
    labs(
      color = 'Country',
      x = 'Country',
      y = '% of recipe weight with nutrient information'
    ) + ylim(0,100)
#Sustainability plot
sustainability_completeness <- plotViolinBox(data_completeness$no_sustainability_indicators) +
    scale_color_manual(values = group_colors) +
    labs(
      color = 'Country',
      x = 'Country',
      y = '% of recipe weight with sustainability indicators'
    ) + ylim(0,100)
#Legend, right
legend <- get_legend(
  nutrients_completeness  + 
    guides(color = guide_legend(nrow = 3)) +
    theme(legend.position = "right")
)

#plot
plot_grid(nutrients_completeness + theme(legend.position  = 'none'),
          sustainability_completeness + theme(legend.position = 'none'),
          legend,
          
          #Labels, number of rows and relative width of plots
          labels = c('A', 'B', ''),
          nrow = 1,
          rel_widths = c(1,1,0.3))
```

Two recipes from the US had \>10% of their ingredients in weight not mapped to the SHARP Indicators database. The ingredients that contributed to this was plantains and pure gluten flour. All other recipes had \<10% of their ingredients in weight not mapped to the database.

## Between countries comparison

Of the total 33 nutrients, healthiness and sustainability indicators assessed, 17 were significantly different (adjusted p value \<0.05) between at least two countries.

Recipes from UK scored significantly better than recipes from Norway and the US on all of the healthiness indicators except the multiple traffic light model **Figure** \@ref(fig:violinbox-health-sustainability)A. The UK recipes also had significantly less environmental impact than recipes from the US, but not Norway. See **Figure** \@ref(fig:violinbox-health-sustainability)B.

```{r violinbox-health-sustainability, fig.cap = "Violin/boxplot of how the recipew from each country scored on the healthiness indicators (A), and sustainability indicators (B).", fig.width = 7, fig.asp = 1.5}
health_plot <- plotViolinBox(health_indicators %>%
                filter(feature %in% c('inverted_nutriscore', 'nutriscore_letter', 'inverted_traffic_score', 'who_score', 'nnr_score', 'keyhole_certified')) %>%
                mutate(feature = feature %>%
                         str_replace('inverted_nutriscore', 'Inverted Nutriscore') %>%
                         str_replace('nnr_score', 'Nordic Nutritional\nRecommendations') %>%
                         str_replace('who_score', 'World Health Organization\nRecommendations') %>%
                         str_replace('inverted_traffic_score', 'Inverted Multiple\nTraffic Light Model'))) +
    facet_wrap(~feature, scales = 'free') +
  labs(
    color = 'Country',
    x = 'Country'
  )
sustainability_plot <- plotViolinBox(run_stats %>%
                filter(feature %in% c('CO2', 'Landuse')) %>%
                mutate(feature = feature %>%
                         str_replace('CO2', 'Kilo CO2 equivalents\nper 100g') %>%
                         str_replace('Landuse', 'm2 per year\nper 100g'))) +
  facet_wrap(~feature, scale = 'free', nrow = 1) +
  labs(
    color = 'Country',
    x = 'Country',
    y = 'Value'
  )
#Extract legend to use in plot so that the size of each facet is the same
legend <- get_legend(
  health_plot + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "bottom")
)

plot_grid(
  health_plot + theme(legend.position="none"), #Without legend
  sustainability_plot + theme(legend.position="none"), #without legend
  legend,
  #Add labels
  labels = c('A', 'B', ''),
  #Number of columns and relative height of the plots in the grid
  ncol = 1,
  rel_heights = c(2,1,.1)
)

```

For the macro- and micronutrients, the UK recipes were significantly higher in copper, folate, vitamin C and dietary fibre than Norwegian and US recipes. Norwegian recipes were significantly higher in iodine than both UK and US recipes, while US recipes were significantly higher in sugar and protein than recipes from Norway and UK.

See **Appendix** **Table** \@ref(tab:stats-data) for the full details.

## Contribution of different food groups to environmental impact of recipes

Per 100 g, meat products followed by seafood, fats and oils (including butter) and dairy products were the ingredients that contributed most to a recipes environmental impact. Recipes from the UK tended to include less meat and dairy than recipes from Norway and the US (**Appendix Figure** \@ref(fig:percent-foodgroups-weight).

## Principal component analysis

The PCA score plot (**Figure** \@ref(fig:PCA-data)A) showed no clustering of recipes from the different countries. The loading plot (**Figure** \@ref(fig:PCA-data)B) showed that vitamin B12 and vitamin A contributed the most to the first principal component, while kilocalories, fat and protein contributed the most to the second principal component.

```{r PCA-data, message=FALSE, fig.cap= "Principal component analysis score plot (A) and loadings plot (B).", fig.width = 6, fig.asp = 1.5}
#Create a feature_anno column to color features by
temp <- run_stats %>%
  mutate(feature_anno = case_when(
    feature %in% c("Kilojoules", "Kilocalories") ~ "Energy",
    feature %in% minerals ~ 'Minerals',
    feature %in% vitamins ~ 'Vitamins',
    feature %in% energy_contributing ~ 'Macronutrient',
    feature %in% sustainability ~ 'Sustainability indicators',
    feature %in% health ~ 'Health indicators'
  ))

#Score plot
score_plot <- createPCA(temp) +
  #Legend at bottom
  theme(legend.position = 'bottom') +
  #Fix lab
  labs(color = 'Country')
#Loading plot with labels
loading_plot <- createPCA(temp, plots = 'loadings', cutoff = 0.043) +
  #Legend at bottom
  theme(legend.position = 'bottom') 

#Plot the scores and loadings
plot_grid(score_plot,
          loading_plot,
          #Labels, relative width/height of plots and number of grid columns
          labels = "AUTO",
          ncol = 1,
          rel_heights = c(1,1.1))

```

The angle between the loading vectors of vitamin B12 and vitamin A, suggests these nutrients are positively correlated. The angle between the loading vectors of kilocalories, fat and protein, suggests a positive correlation between kilocalories in a recipe and its fat content, and a negative correlation between kilocalories and fat with protein content.

## Correlation analyses

```{r Correlation-data}
#Wide df with the variables
temp <- run_stats %>%
  #Make feature names more presentable
  mutate(feature = feature %>%
           str_replace('inverted_nutriscore', 'Inv. Nutriscore') %>%
           str_replace('inverted_traffic_score', 'Inv. Traffic Light') %>%
           str_replace('who_score', 'WHO Score') %>%
           str_replace('nnr_score', 'NNR Score')
  ) %>%
  pivot_wider(., names_from = 'feature', values_from = 'value')

```

### Healthiness indicators and sustainability indicators

Results from the Spearman correlation showed a significant (Holm adjusted p value \<0.001) positive correlation between the four healthiness indicators. Correlation was strongest between the most similar healthiness indicators, such that the two dietary guidelines were more strongly correlated to each other than with either the multiple traffic light model or the Nutriscore, and vice versa. The two sustainability indicators were significantly (Holm adjusted p value \<0.001) positively correlated with each other.

All four healthiness indicators were significantly (Holm adjusted p\<0.001) negatively correlated with the two sustainability indicators, with the two dietary guidelines being more strongly correlated with both GHGE and landuse than the multiple traffic light model and Nutriscore were.

See **Figure** \@ref(fig:Correlation-healthVSsustainability).

```{r Correlation-healthVSsustainability, fig.asp = 0.7, fig.width = 11, fig.cap = "Spearman's Rho between CO2 equivalents (kg), landuse (m2/year) and health indicators.", fig.width = 12, fig.asp = 0.75}
#Health indicators with sustainability indicators
ggpairs(temp %>% select(-sample_id),
        mapping = ggplot2::aes(color=group, alpha = 0.6),
        columns = 29:34,
        upper = list(continuous = myCorrelations),
        lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.1, se = FALSE))) +
  scale_color_manual(values = group_colors) +
  scale_fill_manual(values = group_colors)

```

### Sustainability indicators and energy providing nutrients

There was a weak positive correlation between total energy content in kilocalories, fat, saturated fat, protein and sustainability indicators when all recipes were pooled together (Holm adjusted p value \<0.001). This association did not reach statistical significance in all countries separately. There was a stronger correlation between saturated fat and sustainability indicators than for total fat and sustainability indicators (rho 0.47/0.5 vs rho 0.35/0.36 CO2/Landuse).

Sugar was positively correlated with both sustainability indicators in the pooled recipe data (Holm adjusted p value \<0.01). In both cases this was driven by recipes from the US, where sugar was used in many meat-based recipes as part of a conditment (not shown). There was a trend that sugar was positively correlated with GHGE but not landuse in the UK recipes, while the Norwegian recipes show a trend towards a weak negative correlation with both sustainability indicators. In the Norwegian recipes, sugar was used mainly as a part of a dough.

Landuse had a weak negative correlation with carbohydrates (rho -0.47, Holm adjusted p value \<0.001) and dietary fibre (rho -0.42, Holm adjusted p value \<0.001). GHGE had a moderate negative correlation with carbohydrates (rho -0.53, Holm adjusted p value \<0.001) and a weak negative correlation with dietary fibre (rho -0.48, Holm adjusted p value \<0.001).

In line with the PCA results, energy content was negatively correlated with protein content, and positively correlated with fat and saturated fat.

See **Figure** \@ref(fig:Correlation-energyVSsustainability) for details.

```{r Correlation-energyVSsustainability, fig.cap = "Spearman's Rho between CO2 equivalents (kg), landuse (m2/year), energy content and energy providing nutrients.", fig.width = 18, fig.asp = 0.75}
ggpairs(temp %>% select(-sample_id) %>%
          #Rename some column names
          rename(
            `Carbohydrates E%` = Carbo,
            `Sugar E%` = Sugar,
            `Protein E%` = Protein,
            `Saturated Fat E%` = SatFa,
            `Fat E%` = Fat,
            `Dietary fibre g/MJ` = `Dietary fibre`,
            `kcal/100g` = Kilocalories
          ),
        mapping = ggplot2::aes(color=group, alpha = 0.6),
        columns = c(22:28, 33,34),
        upper = list(continuous = myCorrelations_textsize),
        lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.1, se = FALSE))) +
  scale_color_manual(values = group_colors) +
  scale_fill_manual(values = group_colors)
```

### Sustainability indicators and mineral content

Many minerals were correlated with the sustainability indicators, but the strength and significance of the correlations varied between countries.

There was a weak negative correlation between copper, a mineral often found in plant based foods, and GHGE (rho -0.14, Holm adjusted p value \<0.05). GHGE were positively correlated with Iron (rho 0.34, Holm adjusted p value \<0.001), phoshporus (rho 0.24, Holm adjusted p value \<0.001), selenium (rho 0.16, Holm adjusted p value \<0.01) and zinc (rho 0.64, Holm adjusted p value \<0.001). With copper the correlation was driven by recipes from the US. With iron and zinc, the correlation was weaker for recipes from the UK, and for iron this correlation was not statistically significant in the UK recipes.

Landuse had a weak negative correlation (rho -0.16) with calcium, interestingly this was not visible in the Norwegian recipes, iodine (rho -0.17, Holm adjusted p value \<0.01) and copper (rho -0.21, Holm adjusted p value \<0.001). The correlation between landuse and copper were like the correlation between copper and GHGE driven by recipes from the US. Iron, phosphorus and zinc were positively correlated with landuse. As with the correlations with GHGE, the correlation between landuse and both iron and zinc, were weaker in the UK recipes.

See **Figure** \@ref(fig:Correlation-mineralsVSsustainability).

```{r Correlation-mineralsVSsustainability, fig.cap = "Spearman's Rho between CO2 equivalents (kg), landuse (m2/year) and mineral content (\\% of required daily intake).", fig.align='center', fig.width = 24, fig.asp = 0.75}
ggpairs(temp %>% select(-sample_id),
        mapping = ggplot2::aes(color=group, alpha = 0.6),
        columns = c(2,3, 5:7, 9, 10, 12, 13, 21, 33,34),
        upper = list(continuous = myCorrelations_textsize),
        lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.1, se = FALSE))) +
  scale_color_manual(values = group_colors) +
  scale_fill_manual(values = group_colors)
```

### Sustainability indicators and vitamin content

As with minerals, there were many vitamins that correlated with the sustainability indicators, to various degrees of strength and significance.

GHGE had a weak negative correlation with folate (rho -0.28, Holm adjusted p value \<0.001) in the pooled recipe data, but this did not reach significance in the recipes from Norway. This was the same with vitamin C (rho -0.29, Holm adjusted p value \<0.001). In all countries, there was a weak positive correlation between GHGE and niacin (rho 0.32, Holm adjusted p value \<0.001), riboflavin (rho 0.38, Holm adjusted p value \<0.38) and vitamin B12 (rho 0.49, Holm adjusted p value \<0.001). There was also a weak positive correlation between GHGE vitamin B6 (rho 0.13, Holm adjusted p value \<0.05). For the individual countries, this correlation only reached significance in the recipe data from the US, but there was a trend of the correlation moving in the same direction in the recipes from the UK, but not Norway.

Correlation between the different vitamins and landuse generally followed the same pattern. Vitamin B12 were not significantly correlated with landuse in the Norwegian recipes, and the correlation for the pooled recipes were lower than it was for GHGE. There was also a weak negative correlation between landuse and vitamin D content (rho -0.19, Holm adjusted p value \<0.01), but not in the US recipes alone.

See **Figure** \@ref(fig:Correlation-vitaminsVSsustainability).

```{r Correlation-vitaminsVSsustainability, fig.cap = "Spearman's Rho between CO2 equivalents (kg), landuse (m2/year) and vitamin content (\\% of required daily intake).", fig.align='center', fig.width = 24, fig.asp = 0.75, out.extra = 'angle = 90'}
ggpairs(temp %>% select(-sample_id),
        mapping = ggplot2::aes(color=group, alpha = 0.6),
        columns = c(4,8,11,14:20,33,34),
        upper = list(continuous = myCorrelations_textsize),
        lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.1, se = FALSE))) +
  scale_color_manual(values = group_colors) +
  scale_fill_manual(values = group_colors)
```

# Appendix

```{r stats-data}
stat_table %>%
  #Escape % for LaTeX
  mutate(Feature = str_replace(Feature, "%", "\\\\%")) %>%
  #Format table
  kbl(booktabs = TRUE, linesep = "", caption = "Kruskal Wallis and 
      Dunn test results.", escape = FALSE) %>%
  kable_classic_2(full_width = FALSE)  %>%
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
      add_header_above(c(" " = 1, "Median (IQR)" = 3, "Kruskal-Wallis test" = 2, "Dunn test, Holm corrected" = 2))
```

```{r percent-foodgroups-weight, fig.cap = "How much various food groups contributed to the weight of the recipes.", fig.width = 10, fig.asp = 0.75}
#Percentage of weight from each foodgroup
temp <- tidy_ingredients %>% group_by(group, sample_id, Foodgroup) %>%
  summarise(value = sum(Amounts, na.rm = TRUE))

#Plot
plotViolinBox(temp) + facet_wrap(~Foodgroup) +
  #Labs
  labs(
    y = 'Percentage of recipe weight',
    x = 'Country',
    color = 'Country'
  ) +
  #Fix country colors
  scale_color_manual(values = group_colors) +
  theme(legend.position = 'bottom')

```
