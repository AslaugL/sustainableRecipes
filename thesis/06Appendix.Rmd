# (APPENDIX) Appendix {.unnumbered}

# Appendix

<!--  Fancy page styling -->
\pagestyle{fancy}
\renewcommand{\sectionmark}[1]{ \markright{#1} }
\renewcommand\chaptermark[1]{\markboth{\thechapter\,--\,#1}{}}
\fancyhead[LE]{\nouppercase{\leftmark}}
\fancyhead[RO]{\nouppercase{\rightmark}}
\fancyhead[LO,RE]{}
\fancyfoot[C]{\thepage}

\newpage
```{r pct-recipe-healthiness-fopl}
#Split into two tables, one for the front of pack labels, one for the dietary guidelines.
if(knitr::is_latex_output()){
pct_recipes_healthiness_scores %>%
    select(c(ends_with('Traffic Light Model'), ends_with('Nutriscore'))) %>%
  mutate(across(everything(), ~str_replace(., "%", "\\\\%"))) %>%

kbl(booktabs = TRUE, linesep = "", escape = FALSE,
    
    #Set column names and align
    col.names = rep(c("Score", "Norway", "UK", "US", "All countries"), 2),
    caption = "The percentage of recipes that received a specific score on each front-of-pack-label indicator.",
    align = rep(c("l", "c", "c", "c", "c"), 2)) %>%
  
  #Add header for each indicator
  add_header_above(c("Inverted Multiple Traffic Light Model" = 5, "Nutriscore" = 5)) %>%
  #Add header to distinguish FOPL and guidelines
  add_header_above(c("Front of Pack Labels" = 10)) %>%
  
  #Make score columns bold
  column_spec(., c(1, 6), bold = TRUE) %>%
  column_spec(., c(2:5, 7:10)) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), full_width = FALSE)
  } else {
  pct_recipes_healthiness_scores %>%
    select(c(ends_with('Traffic Light Model'), ends_with('Nutriscore'))) %>%
  mutate(across(everything(), ~str_replace(., "%", "\\\\%"))) %>%

kbl(booktabs = TRUE, linesep = "", escape = FALSE, format = "html",
    
    #Set column names and align
    col.names = rep(c("Score", "Norway", "UK", "US", "All countries"), 2),
    caption = "The percentage of recipes that received a specific score on each front-of-pack-label indicator.",
    align = rep(c("l", "c", "c", "c", "c"), 2)) %>%
  
  #Add header for each indicator
  add_header_above(c("Inverted Multiple Traffic Light Model" = 5, "Nutriscore" = 5)) %>%
  #Add header to distinguish FOPL and guidelines
  add_header_above(c("Front of Pack Labels" = 10)) %>%
  
  #Make score columns bold
  column_spec(., c(1, 6), bold = TRUE) %>%
  column_spec(., c(2:5, 7:10)) %>%
      kable_classic_2() %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), full_width = FALSE)
}
```
```{r pct-recipe-healthiness-guidelines}
#Split into two tables, one for the front of pack labels, one for the dietary guidelines.
if(knitr::is_latex_output()){
pct_recipes_healthiness_scores %>%
    select(ends_with('Recommendations')) %>%
  mutate(across(everything(), ~str_replace(., "%", "\\\\%"))) %>%

kbl(booktabs = TRUE, linesep = "", escape = FALSE,
    
    #Set column names and align
    col.names = rep(c("Score", "Norway", "UK", "US", "All countries"), 2),
    caption = "The percentage of recipes that received a specific score on the dietary guideline indicators.",
    align = rep(c("l", "c", "c", "c", "c"), 2)) %>%
  
  #Add header for each indicator
  add_header_above(c("Nordic Nutritional Recommendations" = 5, "World Health Organization Recommendations" = 5)) %>%
  #Add header to distinguish FOPL and guidelines
  add_header_above(c("Dietary guidelines" = 10)) %>%
  
  #Make score columns bold
  column_spec(., c(1, 6), bold = TRUE) %>%
  column_spec(., c(2:5, 7:10)) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), full_width = FALSE)
  } else {
  pct_recipes_healthiness_scores  %>%
    select(ends_with('Recommendations')) %>%
  mutate(across(everything(), ~str_replace(., "%", "\\\\%"))) %>%

kbl(booktabs = TRUE, linesep = "", escape = FALSE, format = "html",
    
    #Set column names and align
    col.names = rep(c("Score", "Norway", "UK", "US", "All countries"), 2),
    caption = "The percentage of recipes that received a specific score on the dietary guideline indicators.",
    align = rep(c("l", "c", "c", "c", "c"), 2)) %>%
  
  #Add header for each indicator
  add_header_above(c("Nordic Nutritional Recommendations" = 5, "World Health Organization Recommendations" = 5)) %>%
  #Add header to distinguish FOPL and guidelines
  add_header_above(c("Dietary guidelines" = 10)) %>%
  
  #Make score columns bold
  column_spec(., c(1, 6), bold = TRUE) %>%
  column_spec(., c(2:5, 7:10)) %>%
      kable_classic_2() %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), full_width = FALSE)
}
```


```{r data-completeness, fig.cap = "Percentage of the recipe in weight not mapped to a nutrient database (A) and SHARP Indicators environmental impact database (B).", out.width = "100%"}
knitr::include_graphics("images/data_completenes_plot.png")
```

```{r raw-score-nutriscore, fig.cap = "The recipes' raw scores on disqualifying (1-10) and qualifying (1-5) components of the Nutriscore, by country.", out.width = "100%"}
knitr::include_graphics('./images/raw_nutriscores.png')
```

```{r raw-score-guidelines, fig.cap = "The percentage of recipes that adhered to each of the criteria that made up the World Health Organization (top) and Nordic Nutritional Recommendations (bottom) dietary guidelines, by country.", out.width = "100%"}
knitr::include_graphics('./images/raw_scores_guidelines.png')
```

```{r raw-score-trafficlights, fig.cap = "The (inverted) individual scores from each component of the multiple traffic light system, by country.", out.width = "100%"}
knitr::include_graphics('./images/raw_scores_mtl.png')
```

\begin{landscape}
```{r co-occuring-nutrients-source, out.width = "98%", fig.cap = "Nutrients that occur together in the recipes, in such amounts that the recipe is considered a source. A larger circle indicates a higher percentage of recipes that is a source of the nutrient scaled by the number of recipes that used a particular source of protein, and a stronger line indicate a higher number of co-occurrences."}
knitr::include_graphics("images/network_source.png")
```
\end{landscape}

# Appendix
## Data summary

All the data and code used to write this thesis is available in the currently private Github repository "sustainableRecipes". The code is able to recognize recipe ingredients, recalculate volume units into weight and calculate a recipe's nutrient content and environmental impact by using the three databases "Weights, measures and portion sizes for foods" from Norway, the Norwegian food composition datatable 2020 edition, and the SHARP Indicator database. 

Nutrient content can be compared to the macronutrient criteria from the World Health Organization and the Nordic Nutrition Recommendations, and the front-of-pack labels the UK multiple traffic light and French Nutriscore. 

Some volume/weight and nutrients were found from other sources than those listed which can be seen in the clean_database.R script. 

## Data structure
```{=latex}
\newlength\Size
\setlength\Size{4pt}
\tikzset{%
  folder/.pic={%
    \filldraw [draw=folderborder, top color=folderbg!50, bottom color=folderbg] (-1.05*\Size,0.2\Size+5pt) rectangle ++(.75*\Size,-0.2\Size-5pt);
    \filldraw [draw=folderborder, top color=folderbg!50, bottom color=folderbg] (-1.15*\Size,-\Size) rectangle (1.15*\Size,\Size);
  },
  file/.pic={%
    \filldraw [draw=folderborder, top color=folderbg!5, bottom color=folderbg!10] (-\Size,.4*\Size+5pt) coordinate (a) |- (\Size,-1.2*\Size) coordinate (b) -- ++(0,1.6*\Size) coordinate (c) -- ++(-5pt,5pt) coordinate (d) -- cycle (d) |- (c) ;
  },
}
\forestset{%
  declare autowrapped toks={pic me}{},
  pic dir tree/.style={%
    for tree={%
      folder,
      font=\ttfamily,
      grow'=0,
    },
    before typesetting nodes={%
      for tree={%
        edge label+/.option={pic me},
      },
    },
  },
  pic me set/.code n args=2{%
    \forestset{%
      #1/.style={%
        inner xsep=2\Size,
        pic me={pic {#2}},
      }
    }
  },
  pic me set={directory}{folder},
  pic me set={file}{file},
}
\newcommand{\fname}[2]{\begin{tabular}{m{2cm}@{\quad}m{10cm}}#1 & \normalfont#2\end{tabular}}

\begin{forest}
  pic dir tree,
  where level=0{}{% folder icons by default; override using file for file icons
    directory,
  },
  [sustainableRecipes
    [all\_recipes.R, file
    ]
    [analyses.R, file
    ]
    [clean\_databases.R, file
    ]
    [composite\_ingredients.R, file
    ]
    [\fname{Data}{Contains the databases used, the nutrient criteria for the two dietary guidelines and the front-of-pack labels and the recipes.}
    ]
    [DESCRIPTION, file
    ]
    [\fname{man}{Help-manuals for all functions written.}
    ]
    [\fname{R}{Functions written for the thesis.}
    ]
    [README.md, file
    ]
    [sustainableRecipes.Rproj, file
    ]
    [\fname{thesis}{Contains the individual chapter files and figures used in the thesis, in addition to the reference bibliography file.}]
  ]
\end{forest}
```

## How to run
### Clean databases and add composite ingredients to the databases
Open clean_databases.R and block out the code for adding composite ingredients to the nutrient and environmental impact databases. 

Run the code which will create two output files for each of the three databases used in the thesis. One output file is a shortened version of the database while the other is a set of words used to map recipe ingredients to the database.

Then run composite_ingredients.R and go back to clean_databases.R and include the code to add composite ingredients. This step must be done twice as some composite ingredients depend on other composite ingredients.

### Calculate nutrient content and environmental impact of the recipes
After preparing the databases, run all_recipes.R to map the recipe ingredients to the databases and calculate the nutrient content and environmental impact per 100 grams of each recipe.

### Calculate healthiness, run statistical tests, build plots and tables
Run analysis.R script.