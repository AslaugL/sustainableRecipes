---
title: Methods
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
    df_print: paged
  bookdown::pdf_document2:
    keep_tex: yes
  bookdown::word_document2:
    toc: yes
  bookdown::html_document2: default
bibliography: library.bib
---

# Methods

## Data

To assess the association between different recipes, healthiness of the recipes and their environmental impact, 100 recipes from each of Norway, the UK and the US were analysed.

Recipes from Norway and US came from a database of online recipes collected previously. A randomized selection of recipes had been chosen for nutritional analyses previously[@Trattner2017] and were reused for this thesis. Recipes came from Klikk.no (n = 100), Tine.no (n = 100), Aperitif.no (n = 100), Kolonial.no (n = 100) (Norway) and Allrecipes.com (n = 100) (US). Since recipe collection Kolonial has been renamed Oda. The UK recipes came from a random selection from an assortment of UK celebrity chef's recipe books previously used to study the healthiness of television chef's recipes[@Howard2012], Baking Made Easy (n = 7), River Cottage Everyday (n = 21), Jamie's Ministry of Food (n = 22), Jamie's 30 Minute Meals (n = 25) and Nigella's Kitchen (n = 25).

## Calculating nutritional content and environmental impact of the recipes

The dataset used included information about each recipe's energy, macronutrient and sodium content. However, for a more detailed macro-and-micronutrient comparison between the countries, and correlation analysis between healthiness, nutrients and sustainability, the ingredients from each recipe were mapped to the 2020 Norwegian Food Composition Database [@NorwegianFoodSafetyAuthority2020], that contains information about the macro- and micronutrient content per 100 g of commonly consumed foods. If an ingredient was not in the Norwegian database, the US equivalent, Agricultural Research Service FoodData Central food database [@U.S.DepartmentofAgricultureAgriculturalResearchService2019], was used. If the ingredient could not be found in either database it was exchanged for a similar ingredient, for example beef liver was used instead of veal liver.

To calculate a recipe's environmental impact, the SHARP Indicators database was used [@Mertens2019]. The SHARP Indicators database is a public database of certain environmental impacts of different foods, namely greenhouse gas emissions (in kilo CO~2~ equivalents) and land use (in m^2^ pr year) per kg of an ingredient/food. The database includes information on 944 foods commonly consumed in the four European countries Denmark, Czech Republic, Italy and France. The environmental impact in the database comes from life-cycle inventory data on 182 primary products, and many composite foods based on these primary products. This LCA included the environmental impacts of primary production of the food, and the impact of its packaging, transport to supermarket/consumer, storage at the supermarket/consumer, final preparation and any waste produced throughout.

The nutrient content and environmental impact of each recipe was found by summing the values for all ingredients in the recipe. As the SHARP Indicators database categorizes ingredients into foodgroups, the CO~2~ emissions and land use for each food group in a recipe was calculated to see how different food groups contributed to the final score. The food groups used in the SHARP Indicator database can be seen in **Table** \@ref(tab:foodgroups-table).

```{r foodgroups-table}
#Foodgroups in SHARP
standardKbl(tidy_ingredients %>%
  select(Foodgroup) %>% unique() %>% arrange(., Foodgroup), caption = "Foodgroups included in SHARP Indicators database.") %>%
  kable_styling(latex_options = "hold_position")
```

Some ingredients were listed in the recipe with either volume units or number of pieces. Before calculating the nutritional content and environmental impact of these ingredients, standardized weight equivalent was found by primarily using the "Weights, measures and portion sizes for foods" database from The Norwegian Directorate of Health [@ØsterholtDalane2015]. If the ingredient was not in this database the U.S. Department of Agriculture, Agricultural Research Service FoodData Central food database [@U.S.DepartmentofAgricultureAgriculturalResearchService2019] was used, the ingredient was found in the online shops of Meny, Kolonial or COOP, or measured at home.

Some recipes included composite ingredients, such as pastry or pizza dough, not present in either nutrient databases or the SHARP Indicator database. For these ingredients a recipe was found through an online search, similar to how the inventors of the SHARP Indicator database looked up composite foods [@Mertens2019]. Nutrient content, CO~2~ emission and land use were calculated for the composite ingredient and normalized to per 100 g of the ingredient, before being added to the recipe like any other ingredient.

For both the sustainability markers and nutritional information, values were normalized to per 100 g of a recipe.

## Recipe healthiness

Recipes were scored on how well they adhered to the dietary guidelines supplied by the WHO and the NNR, see **Table** \@ref(tab:guidelines-points-table). A recipe would receive one point for each recommendation in the guideline it adhered to, giving a total score between 0-6. For example a recipe could score one point for having between 15-30% energy (E%) coming from fat. A higher score indicates higher adherence to the guideline.

```{r guidelines-points-table}
#Has problems with %
guidelines_trafficlights %>% select(Feature, `World Health Organization`, `Nordic Nutritional Recommendation`) %>%
  
  #Escape % for latex
  mutate_at(c("World Health Organization", "Nordic Nutritional Recommendation"), ~str_replace(., "E%", "E\\\\%")) %>%
  
  filter(Feature != "Salt") %>%
  kbl(booktabs = TRUE, linesep = "", caption = "Scoring system for the dietary guidelines from World Health Organization and the Nordic countries.", escape = FALSE) %>%
  kable_classic_2(full_width = FALSE) %>%
  kable_styling(latex_options = "hold_position") %>%
  add_header_above(c(' ' = 1, 'Dietary guidelines' = 2))
```

For these analyses, energy providing nutrients fat, saturated fat, carbohydrates, added sugar and protein were recalculated to E%, and dietary fibre to grams per megajoule, from the original raw values of grams found in the nutrient databases.

Energy percentage of each of the nutrients were found by first calculating the amount of kilocalories provided by each nutrient: multiplying the amount in grams of fat and saturated fat by nine, and for carbohydrates, sugar added sugar and protein by four. This was then divided by the total amount of kilocalories per 100 g and multiplied by 100. Grams of fibre per megajoule was found by dividing the amount of fibre in grams by the energy in megajoule.

Additionally, the recipes were assessed as to how well they adhered to the UK Food Standard Agency multiple traffic light system and the French Nutriscore system. These scoring systems have been created to be used on single foods, unlike dietary guidelines that are frameworks for whole diets. The traffic light system looks at a food's fat, saturated fat, sugar and salt content, and gives each category a score between green "low", amber "medium" and red "high" depending on how much of the nutrient the food contains per 100 g, see **Table** \@ref(tab:traffic-lights-points-table). Consumers are advised to choose foods with more green and amber than red [@BritishNutritionFoundation2019]. The original traffic light system gives a score of 1 for "low", 2 for "medium" and 3 for "high", and a food can score between 4-12, with a lower score being a healthier choice. To be in line with the dietary guideline recommendations where a higher score indicates better adherence, an inverted scoring system for the multiple traffic light system will be used for the analyses in this thesis.

```{r traffic-lights-points-table}
guidelines_trafficlights %>%
      select(Feature, `Green/low`, `Amber/medium`, `Red/high`) %>%
      filter(!Feature %in% c('Carbohydrate', 'Dietary fibre', 'Protein')) %>%
  #LaTeX less than or equal to sign
  mutate_at(c("Green/low", "Amber/medium", "Red/high"), ~str_replace(., "≤", "$\\leq$")) %>%
  
  kbl(booktabs = TRUE, linesep = "", escape = FALSE, caption = "Scoring system for the multiple traffic light model.") %>%
  kable_classic_2(full_width = FALSE) %>%
  kable_styling(latex_options = "hold_position") %>%
  add_header_above(c(' ' = 1, 'Multiple traffic light model' = 3))
```

The Nutriscore is similar, but it builds on the multiple traffic light model by also taking into account the amount of energy and protein in a food, in addition to the amount of fibre, fruit, vegetables, pulses and nuts and the healthy fats olive oil, rapeseed oil and walnut oil [@Chantal2017; @Hercberg2021]. In the Nutriscore system, a food can receive between 0-10 points for each of the "disqualifying" categories energy, added sugar, saturated fat and sodium, and 0-5 points for the "qualifying" categories of protein, fibre, and the percentage of fruit, vegetables, pulses and nuts and the healthy fats olive oil, rapeseed oil and walnut oil per 100 g of the food.

The points from the qualifying categories are subtracted from the points from the disqualifying categories, see **Table** \@ref(tab:nutriscore-points-table), giving a total of -15 to +40, and a lower score indicates a more healthy and nutritious food. As with the multiple traffic light system, an inverted scoring system is used in the analyses in this thesis.

```{r nutriscore-points-table}
nutriscore_points %>%
  kbl(booktabs = TRUE, linesep = "", escape = TRUE, caption = "Scoring system for Nutriscore.") %>%
  kable_classic_2(full_width = FALSE) %>%
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
  add_header_above(c(' ' = 1, 'Disqualifying' = 4, 'Qualifying' = 3)) %>%
  #Linebreak for long column names
  column_spec(2:4, width = "3cm") %>%
  column_spec(c(5, 7, 8), width = "2.5cm") %>%
  column_spec(6, width = "5cm")
```

The percentage of fruit, vegetables, pulses, nuts and healthy fats were found by summing the amounts of ingredients found in the foodgroups "Fruit and fruit products", "Vegetable and vegetable products", "Fruit/vegetable juice and nectar" and "Legumes, nuts, seeds" from the SHARP Indicator database, in addition to the amounts of olive, rapeseed and walnut oil per 100 g of the recipe.

## Statistical analyses

### Missing data

Ingredients with no amounts were replaced with the mean value of that ingredient in all other recipes, normalized to per 100 g of the recipe. If this was not possible, ingredients were left out of the analyses. Ingredients that could not be found in the nutrient or sustainability databases were if possible exchanged for a similar ingredient, or left out.

### Significant differences between countries

Significant differences in energy per 100 g, macronutrient content in percentage of energy, micronutrient content in percentage of required daily intake of an adult woman, healthiness scores and sustainability indicators between recipes from the different countries were assessed using the Kruskal-Wallis test. A Dunn's test was performed post-hoc, and to account for multiple testing the Benjamini Hochberg method was used. An adjusted p value \< 0.05 was considered significant. 

All tests were done using the rstatix package v. 0.7.0 [@Kassambara2021].

### Correlation analysis

To explore possible correlation between variables Spearman's rho were calculated using the Psych library v. 2.1.6 [@Raiche2013] corr.test function. This was done for the recipes from each country individually and for the pooled data from all countries. P values were calculated and corrected for multiple testing using the Benjamini Hochberg method and an adjusted p value \< 0.05 was considered significant.

### Principal Component Analysis

A principal component analysis (PCA) was performed to see which features in the data that could best explain the variance seen in the recipes. A PCA find the linear transformation that best preserves as much variance as possible [@Worley2013]. The line that explains the most variance is the first principal component, the second line, the second principal components, is perpendicular to principal component 1 and explains the second most variance, and so on.

Plotting the recipes together with their principal components values creates a score plot, where recipes with similar feature values cluster together. Principal component loadings explain which features, in this case nutrients and environmental impact markers, contribute most the principal components and can be visualized in loading plots. Loadings project out from origo, and the length of the vector shows how much they contribute to a principal component, while the angle between the vectors can show how the features correlate with each other.
